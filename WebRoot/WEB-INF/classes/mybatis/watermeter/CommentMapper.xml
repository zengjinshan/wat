<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CommentMapper">

    <select id="findCommentList" resultType="commentVo" parameterType="java.util.Map">
        SELECT ID,USER_IMG,
        COMMENT_CONTENT,
        DATE_FORMAT(CREATE_DATE,"%Y-%m-%d %H:%i:%s") AS CREATE_DATE,
        OBSERVER,
        OBSERVER_ID,
        INFO_ID,
        COMMENT_INFO_TYPE
        FROM T_W_COMMENT WHERE 1=1
        <if test="infoId!=null and infoId!=''">
            AND INFO_ID=#{infoId}
        </if>
        ORDER BY CREATE_DATE DESC
    </select>

    <select id="countRelateToMe" resultType="java.lang.Integer" parameterType="java.util.Map">
        SELECT COUNT(1) FROM T_W_COMMENT
        WHERE 1=1
        AND INFO_ID IN
        (SELECT INFO_ID FROM T_W_COMMENT
        WHERE 1=1
        AND (OBSERVER_ID=#{userId} OR BY_OBSERVER_ID=#{userId})
         )
         <if test="startTime!=null">
             AND CREATE_DATE>=#{startTime}
         </if>
        <if test="endTime!=null">
            AND CREATE_DATE &lt;= #{endTime}
        </if>
    </select>

    <select id="relateToMe" resultType="relateToMeVo" parameterType="java.util.Map">
        SELECT ID,INFO_ID,COMMENT_CONTENT,CREATE_DATE,COMMENT_CONTENT_TYPE,
        FILE_PATH,USER_IMG,COMMENT_INFO_TYPE,OFFER_MONEY,OBSERVER,OBSERVER_ID
        FROM T_W_COMMENT
        WHERE 1=1
        AND INFO_ID IN
        (SELECT INFO_ID FROM T_W_COMMENT
        WHERE 1=1
        AND (OBSERVER_ID=#{userId} OR BY_OBSERVER_ID=#{userId})
        )
        <if test="startTime!=null">
            AND CREATE_DATE>=#{startTime}
        </if>
        <if test="endTime!=null">
            AND CREATE_DATE &lt;= #{endTime}
        </if>
        ORDER BY CREATE_DATE DESC
    </select>


</mapper>